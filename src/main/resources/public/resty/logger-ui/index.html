<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>LogBack Configuration</title>
  <link href='bootstrap-3.3.7/css/bootstrap.min.css' rel='stylesheet' type='text/css'/>
  <script src='riot-3.0.5/riot+compiler.min.js' type='text/javascript'></script>
  <script src='jquery-3.1.1/jquery-3.1.1.min.js' type='text/javascript'></script>
  <script src='bootstrap-3.3.7/js/bootstrap.min.js' type='text/javascript'></script>
</head>
<body>
  <div class="container">
    <h1 class="page-header">LogBack Configuration</h1>
    <logger-table></logger-table>
  </div>
  <script type="riot/tag">
    <logger-table>
      <form id="form" class="form">
        <table class="table table-bordered">
          <thead>
            <tr>
              <th>Logger name</th>
              <th>Log level</th>
            </tr>
          </thead>
          <tbody>
            <tr each={items}>
              <td>{name}</td>
              <td>
                <select class="logger" name={name}>
                  <option each={item in levels} selected={level == item}>{item}</option>
                </select>
              </td>
            </tr>
          </tbody>
        </table>
        <input type="reset" value="Reset" class="btn btn-default">
        <input type="button" value="Save" class="btn btn-primary" onclick={save}>
      </form>
      this.levels = ['UNSPECIFIED', 'OFF', 'ERROR', 'WARN', 'INFO', 'DEBUG', 'TRACE', 'ALL'];

      this.items = [];
      var self = this;
      $.get('http://localhost:8080/logger/levels', function(items){
        self.items = items;
        self.update();
      });

      save(event){
        var data = { loggers: [] };
        $('.logger').each(function(i, e){
          data.loggers.push({
            name: $(e).attr('name'),
            level: $(e).val()
          });
        });
        $.ajax({
          type: 'post',
          url: 'http://localhost:8080/logger/levels',
          data: JSON.stringify(data),
          contentType: 'application/json',
          success: function(){
            $('h1').after($(
              '<div class="alert alert-success alert-dismissible" role="alert">' +
              '<button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>' +
              'Succeed to save configuration!' +
              '</div>'
            ));
          },
          error: function(xhr, status, error){
            console.log(error);
          }
        });
      }
    </logger-table>
  </script>
  <script>
    riot.mount('logger-table');
  </script>
</body>